elasticsearch:
  image: elasticsearch:latest
  container_name: elasticsearch
  command: elasticsearch -Des.network.host=_non_loopback_ -Des.cluster.name=elk1 -Des.node.master=true
  ports:
    - "9200:9200"
    - "9300:9300"

slave:
  image: elasticsearch:latest
  name: "slave"
  command: elasticsearch -Des.network.host=_non_loopback_ -Des.cluster.name=elk1 -Des.node.master=false
  ports:
    - 9201
    - 9301
  links:
    - elasticsearch:elasticsearch

logstash:
  image: logstash:latest
  command: bash -c "plugin install logstash-input-beats && logstash -f /etc/logstash/conf.d/logstash.conf"
  volumes:
    - ./logstash/config:/etc/logstash/conf.d
  ports:
    - "5400:5400"
  links:
    - elasticsearch:elasticsearch
    - slave

kibana:
  build: kibana/
  volumes:
    - ./kibana/config/kibana.yml:/opt/kibana/config/kibana.yml
  ports:
    - "5601:5601"
  links:
    - elasticsearch:elasticsearch
#curl -XPUT "http://0.0.0.0:9200/.kibana/_settings" -d '{ "index" : { "max_result_window" : 2147483647 } }'
